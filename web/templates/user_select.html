{{define "user-select-bar"}}
<div class="flex items-center gap-2">
    {{range .Members}}
    <div class="tooltip tooltip-bottom" data-tip="{{.Name}}">
        {{if .HasPIN}}
        <button class="avatar placeholder cursor-pointer transition-all"
                onclick="document.getElementById('pin-modal').showModal()"
                hx-get="/partials/user/pin-challenge/{{.ID}}"
                hx-target="#pin-modal-body"
                hx-swap="innerHTML">
            <div class="w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center text-base md:text-lg ring-offset-base-100 ring-offset-2 transition-all {{if eq $.ActiveUserID .ID}}ring ring-primary{{else}}opacity-50 hover:opacity-80{{end}}"
                 style="background-color: {{.Color}}20; border: 2px solid {{.Color}}">
                {{.AvatarEmoji}}
            </div>
        </button>
        {{else}}
        <button class="avatar placeholder cursor-pointer transition-all"
                hx-post="/partials/user/select/{{.ID}}"
                hx-target="#user-select-bar"
                hx-swap="innerHTML">
            <div class="w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center text-base md:text-lg ring-offset-base-100 ring-offset-2 transition-all {{if eq $.ActiveUserID .ID}}ring ring-primary{{else}}opacity-50 hover:opacity-80{{end}}"
                 style="background-color: {{.Color}}20; border: 2px solid {{.Color}}">
                {{.AvatarEmoji}}
            </div>
        </button>
        {{end}}
    </div>
    {{end}}
    {{if not .Members}}
    <a href="/settings/family" class="btn btn-sm btn-ghost text-base-content/50">Add family members</a>
    {{end}}
</div>
{{end}}

{{define "weather-widget"}}
{{if not .Configured}}
<div class="text-sm text-base-content/40"
     hx-get="/partials/weather"
     hx-trigger="every 1800s"
     hx-swap="outerHTML">
    Set location for weather
</div>
{{else if not .Available}}
<div class="text-sm text-base-content/40"
     hx-get="/partials/weather"
     hx-trigger="every 1800s"
     hx-swap="outerHTML">
    Weather unavailable
</div>
{{else}}
<div class="flex items-center gap-2 text-sm"
     hx-get="/partials/weather"
     hx-trigger="every 1800s"
     hx-swap="outerHTML">
    <span class="text-xl">{{.CurrentIcon}}</span>
    <span class="font-bold text-lg">{{printf "%.0f" .CurrentTemp}}&deg;{{.Unit}}</span>
    <span class="text-base-content/60">{{.CurrentDesc}}</span>
    <span class="hidden sm:inline text-base-content/40 text-xs">H:{{printf "%.0f" .HighTemp}}&deg; L:{{printf "%.0f" .LowTemp}}&deg;</span>
</div>
{{end}}
{{end}}

{{define "pin-challenge"}}
<div x-data="{ pin: '' }">
    <h3 class="text-lg font-bold mb-2">Enter PIN for {{.Name}}</h3>
    <p class="text-sm text-base-content/60 mb-4">Enter your 4-digit PIN to switch user.</p>

    <form hx-post="/partials/user/verify-pin/{{.ID}}"
          hx-target="#user-select-bar"
          hx-swap="innerHTML"
          class="flex flex-col items-center gap-4">

        <input type="hidden" name="pin" :value="pin" />

        <!-- PIN display -->
        <div class="flex gap-3 mb-2">
            <template x-for="i in 4" :key="i">
                <div class="w-12 h-12 md:w-14 md:h-14 border-2 rounded-lg flex items-center justify-center text-2xl font-bold"
                     :class="pin.length >= i ? 'border-primary bg-primary/10' : 'border-base-300'">
                    <span x-show="pin.length >= i">&#9679;</span>
                </div>
            </template>
        </div>

        <!-- Number pad -->
        <div class="grid grid-cols-3 gap-2 max-w-xs">
            <template x-for="n in [1,2,3,4,5,6,7,8,9]" :key="n">
                <button type="button"
                        class="btn btn-lg btn-outline w-14 h-14 md:w-16 md:h-16 text-xl"
                        @click="if(pin.length < 4) pin += n.toString()"
                        x-text="n"></button>
            </template>
            <div></div>
            <button type="button"
                    class="btn btn-lg btn-outline w-14 h-14 md:w-16 md:h-16 text-xl"
                    @click="if(pin.length < 4) pin += '0'">0</button>
            <button type="button"
                    class="btn btn-lg btn-ghost w-14 h-14 md:w-16 md:h-16 text-xl"
                    @click="pin = pin.slice(0, -1)">&#9003;</button>
        </div>

        <div class="flex gap-2 mt-4">
            <button type="submit"
                    class="btn btn-primary btn-lg"
                    :disabled="pin.length !== 4">Verify</button>
            <button type="button"
                    class="btn btn-ghost btn-lg"
                    onclick="document.getElementById('pin-modal').close()">Cancel</button>
        </div>
    </form>
</div>
{{end}}
