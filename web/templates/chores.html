{{define "chores-content"}}
<div class="max-w-4xl mx-auto" x-data="{ tab: 'all' }">
    <div class="flex items-center justify-between mb-4">
        <h1 class="text-2xl md:text-3xl font-bold">Chores</h1>
        <div class="flex items-center gap-2">
            <a class="btn btn-ghost btn-sm"
               hx-get="/partials/rewards"
               hx-target="#main-content"
               hx-push-url="/chores/rewards">Rewards</a>
            <a class="btn btn-ghost btn-sm"
               hx-get="/partials/chores/manage"
               hx-target="#main-content"
               hx-push-url="/chores/manage">Manage</a>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="tabs tabs-boxed tabs-sm md:tabs-lg mb-4">
        <button class="tab"
                :class="tab === 'all' ? 'tab-active' : ''"
                hx-get="/partials/chores/all"
                hx-target="#chore-list-content"
                @click="tab = 'all'">All</button>
        <button class="tab"
                :class="tab === 'by-person' ? 'tab-active' : ''"
                hx-get="/partials/chores/by-person"
                hx-target="#chore-list-content"
                @click="tab = 'by-person'">By Person</button>
        <button class="tab"
                :class="tab === 'by-area' ? 'tab-active' : ''"
                hx-get="/partials/chores/by-area"
                hx-target="#chore-list-content"
                @click="tab = 'by-area'">By Area</button>
    </div>

    <!-- Chore List Content -->
    <div id="chore-list-content">
        {{template "chore-list-all" .}}
    </div>

    <!-- Floating Add Button -->
    <button class="btn btn-primary btn-circle btn-lg fixed bottom-20 right-4 md:bottom-24 md:right-6 shadow-lg z-20"
            hx-get="/partials/chores/new"
            hx-target="#chore-modal-body"
            hx-swap="innerHTML"
            onclick="document.getElementById('chore-modal').showModal()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
    </button>
</div>

<!-- Chore Modal -->
<dialog id="chore-modal" class="modal">
    <div id="chore-modal-body" class="modal-box w-[calc(100%-2rem)] max-w-lg">
        <!-- Chore form loaded here via HTMX -->
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>
{{end}}

{{define "chore-list-all"}}
<div class="space-y-2">
    {{if not .Chores}}
    <div class="card bg-base-100 shadow-md">
        <div class="card-body items-center text-center py-12">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-base-content/30 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
            </svg>
            <p class="text-base-content/60">No chores yet. Tap + to create one.</p>
        </div>
    </div>
    {{else}}
    {{range .Chores}}
    {{template "chore-card" .}}
    {{end}}
    {{end}}
</div>
{{end}}

{{define "chore-list-by-person"}}
<div class="space-y-4">
    {{if not .PersonGroups}}
    <div class="card bg-base-100 shadow-md">
        <div class="card-body items-center text-center py-8">
            <p class="text-base-content/60">No chores assigned to anyone yet.</p>
        </div>
    </div>
    {{else}}
    {{range .PersonGroups}}
    <div class="card bg-base-100 shadow-md">
        <div class="card-body p-4">
            <div class="flex items-center gap-3 mb-3">
                <div class="text-2xl">{{.MemberEmoji}}</div>
                <div class="flex-1">
                    <div class="font-bold text-lg">{{.MemberName}}</div>
                    <div class="text-sm text-base-content/60">{{.Done}} of {{.Total}} done</div>
                </div>
                <progress class="progress progress-primary w-20" value="{{.Done}}" max="{{.Total}}"></progress>
            </div>
            <div class="space-y-1">
                {{range .Chores}}
                {{template "chore-card" .}}
                {{end}}
            </div>
        </div>
    </div>
    {{end}}
    {{end}}
</div>
{{end}}

{{define "chore-list-by-area"}}
<div class="space-y-4">
    {{if not .AreaGroups}}
    <div class="card bg-base-100 shadow-md">
        <div class="card-body items-center text-center py-8">
            <p class="text-base-content/60">No chores created yet.</p>
        </div>
    </div>
    {{else}}
    {{range .AreaGroups}}
    <div class="card bg-base-100 shadow-md">
        <div class="card-body p-4">
            <h3 class="font-bold text-lg mb-3">{{.AreaName}}</h3>
            <div class="space-y-1">
                {{range .Chores}}
                {{template "chore-card" .}}
                {{end}}
            </div>
        </div>
    </div>
    {{end}}
    {{end}}
</div>
{{end}}

{{define "chore-card"}}
<div class="chore-card flex items-center gap-3 p-3 rounded-lg bg-base-200/50 {{if eq .Status "completed"}}opacity-60{{end}} {{if eq .Status "overdue"}}border-l-4 border-error{{end}}">
    {{if eq .Status "completed"}}
    <!-- Undo button (checked state) -->
    <input type="checkbox" checked
           class="checkbox checkbox-lg checkbox-success"
           hx-post="/partials/chores/{{.ID}}/undo-complete"
           hx-target="#chore-list-content"
           hx-swap="innerHTML" />
    {{else}}
    <!-- Complete button -->
    <input type="checkbox"
           class="checkbox checkbox-lg"
           hx-post="/partials/chores/{{.ID}}/complete"
           hx-target="#chore-list-content"
           hx-swap="innerHTML"
           hx-on::before-request="this.closest('.chore-card').classList.add('chore-card-completing')" />
    {{end}}

    <div class="flex-1 min-w-0 {{if eq .Status "completed"}}line-through text-base-content/50{{end}}">
        <div class="font-medium truncate">{{.Title}}</div>
        <div class="flex items-center gap-2 flex-wrap mt-1">
            {{if .AreaName}}
            <span class="badge badge-sm badge-outline">{{.AreaName}}</span>
            {{end}}
            {{if .Points}}
            <span class="badge badge-sm badge-warning">{{.Points}} pts</span>
            {{end}}
            {{if .RecurrenceRule}}
            <span class="badge badge-sm badge-info">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                Recurring
            </span>
            {{end}}
            {{if eq .Status "overdue"}}
            <span class="badge badge-sm badge-error">Overdue</span>
            {{end}}
        </div>
    </div>

    {{if .MemberEmoji}}
    <div class="text-xl" title="{{.MemberName}}" {{if .MemberColor}}style="filter: drop-shadow(0 0 2px {{.MemberColor}})"{{end}}>{{.MemberEmoji}}</div>
    {{end}}

    <button class="btn btn-ghost btn-sm btn-square"
            hx-get="/partials/chores/{{.ID}}/edit"
            hx-target="#chore-modal-body"
            hx-swap="innerHTML"
            onclick="document.getElementById('chore-modal').showModal()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
        </svg>
    </button>
</div>
{{end}}

{{define "chore-form"}}
<div>
    <h3 class="text-xl font-bold mb-4">New Chore</h3>
    <form hx-post="/partials/chores"
          hx-target="#chore-list-content"
          hx-swap="innerHTML">
        <div class="form-control mb-3">
            <label class="label"><span class="label-text">Title</span></label>
            <input type="text" name="title" class="input input-bordered" placeholder="Chore name" required />
        </div>

        <div class="form-control mb-3">
            <label class="label"><span class="label-text">Description</span></label>
            <textarea name="description" class="textarea textarea-bordered" placeholder="Optional details"></textarea>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3">
            <div class="form-control">
                <label class="label"><span class="label-text">Area</span></label>
                <select name="area_id" class="select select-bordered">
                    <option value="0">None</option>
                    {{range .Areas}}
                    <option value="{{.ID}}">{{.Name}}</option>
                    {{end}}
                </select>
            </div>

            <div class="form-control">
                <label class="label"><span class="label-text">Points</span></label>
                <input type="number" name="points" class="input input-bordered" value="0" min="0" />
            </div>
        </div>

        <div class="form-control mb-3">
            <label class="label"><span class="label-text">Repeats</span></label>
            <select name="recurrence_rule" class="select select-bordered">
                <option value="">One-time</option>
                <option value="FREQ=DAILY">Daily</option>
                <option value="FREQ=WEEKLY">Weekly</option>
                <option value="FREQ=WEEKLY;INTERVAL=2">Every 2 weeks</option>
                <option value="FREQ=MONTHLY">Monthly</option>
            </select>
        </div>

        <div class="form-control mb-4">
            <label class="label"><span class="label-text">Assign to</span></label>
            <div class="flex flex-wrap gap-2">
                <label class="cursor-pointer">
                    <input type="radio" name="assigned_to" value="0" class="hidden peer" checked />
                    <div class="btn btn-sm peer-checked:btn-primary">Nobody</div>
                </label>
                {{range .Members}}
                <label class="cursor-pointer">
                    <input type="radio" name="assigned_to" value="{{.ID}}" class="hidden peer" />
                    <div class="btn btn-sm peer-checked:btn-primary">{{.AvatarEmoji}} {{.Name}}</div>
                </label>
                {{end}}
            </div>
        </div>

        <div class="modal-action">
            <button type="button" class="btn" onclick="document.getElementById('chore-modal').close()">Cancel</button>
            <button type="submit" class="btn btn-primary">Create</button>
        </div>
    </form>
</div>
{{end}}

{{define "chore-edit-form"}}
<div>
    <h3 class="text-xl font-bold mb-4">Edit Chore</h3>
    <form hx-put="/partials/chores/{{.ID}}"
          hx-target="#chore-list-content"
          hx-swap="innerHTML">
        <div class="form-control mb-3">
            <label class="label"><span class="label-text">Title</span></label>
            <input type="text" name="title" class="input input-bordered" value="{{.Title}}" required />
        </div>

        <div class="form-control mb-3">
            <label class="label"><span class="label-text">Description</span></label>
            <textarea name="description" class="textarea textarea-bordered">{{.Description}}</textarea>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3">
            <div class="form-control">
                <label class="label"><span class="label-text">Area</span></label>
                <select name="area_id" class="select select-bordered">
                    <option value="0">None</option>
                    {{range .Areas}}
                    <option value="{{.ID}}" {{if eq .ID $.AreaID}}selected{{end}}>{{.Name}}</option>
                    {{end}}
                </select>
            </div>

            <div class="form-control">
                <label class="label"><span class="label-text">Points</span></label>
                <input type="number" name="points" class="input input-bordered" value="{{.Points}}" min="0" />
            </div>
        </div>

        <div class="form-control mb-3">
            <label class="label"><span class="label-text">Repeats</span></label>
            <select name="recurrence_rule" class="select select-bordered">
                <option value="" {{if eq .RecurrenceRule ""}}selected{{end}}>One-time</option>
                <option value="FREQ=DAILY" {{if eq .RecurrenceRule "FREQ=DAILY"}}selected{{end}}>Daily</option>
                <option value="FREQ=WEEKLY" {{if eq .RecurrenceRule "FREQ=WEEKLY"}}selected{{end}}>Weekly</option>
                <option value="FREQ=WEEKLY;INTERVAL=2" {{if eq .RecurrenceRule "FREQ=WEEKLY;INTERVAL=2"}}selected{{end}}>Every 2 weeks</option>
                <option value="FREQ=MONTHLY" {{if eq .RecurrenceRule "FREQ=MONTHLY"}}selected{{end}}>Monthly</option>
            </select>
        </div>

        <div class="form-control mb-4">
            <label class="label"><span class="label-text">Assign to</span></label>
            <div class="flex flex-wrap gap-2">
                <label class="cursor-pointer">
                    <input type="radio" name="assigned_to" value="0" class="hidden peer" {{if eq .AssignedTo 0}}checked{{end}} />
                    <div class="btn btn-sm peer-checked:btn-primary">Nobody</div>
                </label>
                {{range .Members}}
                <label class="cursor-pointer">
                    <input type="radio" name="assigned_to" value="{{.ID}}" class="hidden peer" {{if eq .ID $.AssignedTo}}checked{{end}} />
                    <div class="btn btn-sm peer-checked:btn-primary">{{.AvatarEmoji}} {{.Name}}</div>
                </label>
                {{end}}
            </div>
        </div>

        <div class="modal-action">
            <button type="button" class="btn btn-error btn-outline"
                    hx-delete="/partials/chores/{{.ID}}"
                    hx-target="#chore-list-content"
                    hx-swap="innerHTML"
                    hx-confirm="Delete this chore?">Delete</button>
            <button type="button" class="btn" onclick="document.getElementById('chore-modal').close()">Cancel</button>
            <button type="submit" class="btn btn-primary">Save</button>
        </div>
    </form>
</div>
{{end}}

{{define "chore-manage-content"}}
<div class="max-w-4xl mx-auto">
    <div class="flex items-center justify-between mb-4">
        <h1 class="text-2xl md:text-3xl font-bold">Manage Chores</h1>
        <button class="btn btn-ghost btn-sm"
                hx-get="/partials/chores"
                hx-target="#main-content"
                hx-push-url="/chores">Back to Chores</button>
    </div>

    <!-- Chore List -->
    <div class="card bg-base-100 shadow-md mb-6">
        <div class="card-body">
            <h2 class="card-title mb-3">Chores</h2>
            {{if not .Chores}}
            <p class="text-base-content/60">No chores created yet.</p>
            {{else}}
            <div class="overflow-x-auto">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Area</th>
                            <th>Assigned</th>
                            <th>Points</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .Chores}}
                        <tr>
                            <td class="font-medium">{{.Title}}</td>
                            <td>{{.AreaName}}</td>
                            <td>{{.MemberName}}</td>
                            <td>{{.Points}}</td>
                            <td class="text-right">
                                <button class="btn btn-ghost btn-xs"
                                        hx-get="/partials/chores/{{.ID}}/edit"
                                        hx-target="#chore-modal-body"
                                        hx-swap="innerHTML"
                                        onclick="document.getElementById('chore-modal').showModal()">Edit</button>
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            {{end}}
        </div>
    </div>

    <!-- Area Management -->
    <div class="card bg-base-100 shadow-md">
        <div class="card-body">
            <h2 class="card-title mb-3">Areas</h2>
            <div id="area-list">
                {{template "chore-area-list" .}}
            </div>
        </div>
    </div>
</div>

<!-- Chore Modal (for edit from manage page) -->
<dialog id="chore-modal" class="modal">
    <div id="chore-modal-body" class="modal-box w-[calc(100%-2rem)] max-w-lg">
    </div>
    <form method="dialog" class="modal-backdrop">
        <button>close</button>
    </form>
</dialog>
{{end}}

{{define "chore-area-list"}}
<div class="space-y-2">
    {{range .Areas}}
    <div class="flex items-center gap-2" x-data="{ editing: false }">
        <template x-if="!editing">
            <div class="flex items-center gap-2 flex-1">
                <span class="flex-1 font-medium">{{.Name}}</span>
                <button class="btn btn-ghost btn-xs" @click="editing = true">Rename</button>
                <button class="btn btn-ghost btn-xs text-error"
                        hx-delete="/partials/chores/areas/{{.ID}}"
                        hx-target="#area-list"
                        hx-swap="innerHTML"
                        hx-confirm="Delete area '{{.Name}}'? Chores in this area will become unassigned.">Delete</button>
            </div>
        </template>
        <template x-if="editing">
            <form class="flex items-center gap-2 flex-1"
                  hx-put="/partials/chores/areas/{{.ID}}"
                  hx-target="#area-list"
                  hx-swap="innerHTML">
                <input type="text" name="name" class="input input-bordered input-sm flex-1" value="{{.Name}}" required />
                <button type="submit" class="btn btn-sm btn-primary">Save</button>
                <button type="button" class="btn btn-sm btn-ghost" @click="editing = false">Cancel</button>
            </form>
        </template>
    </div>
    {{end}}

    <!-- Add Area Form -->
    <form class="flex items-center gap-2 mt-4 pt-4 border-t border-base-300"
          hx-post="/partials/chores/areas"
          hx-target="#area-list"
          hx-swap="innerHTML">
        <input type="text" name="name" class="input input-bordered input-sm flex-1" placeholder="New area name" required />
        <button type="submit" class="btn btn-sm btn-primary">Add Area</button>
    </form>
</div>
{{end}}

{{define "chore-summary-widget"}}
{{if .ChoreSummary}}
<div class="space-y-2">
    {{range .ChoreSummary}}
    <div class="flex items-center gap-2">
        <span class="text-lg">{{.MemberEmoji}}</span>
        <span class="font-medium flex-1">{{.MemberName}}</span>
        <span class="text-sm text-base-content/60">{{.Done}}/{{.Total}}</span>
        <progress class="progress progress-primary w-16" value="{{.Done}}" max="{{.Total}}"></progress>
    </div>
    {{end}}
</div>
{{else}}
<p class="text-base-content/60">No chores assigned</p>
{{end}}
{{end}}
